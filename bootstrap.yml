---
- hosts: nonlocal
  gather_facts: false
  tags: launch
  roles:
    - { role: ensure-instance, state: "present" }

- hosts: openstack
  tags: deploy
  roles:
    - { role: sudo }
    - { role: devstack }

- hosts: openstack
  tags: rally
  roles:
    - { role: rally}

- name: Retrieve logs
  hosts: openstack
  tags: rally
  fetch: dest=logs src=/home/stack/devstack/logs flat=yes

- name: Remove instances
  hosts: nonlocal
  tags: destroy
  gather_facts: false
  roles:
    - { role: ensure-instance, state: "absent" }
